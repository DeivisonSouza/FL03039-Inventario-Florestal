---
title: "Simula√ß√£o de Dados Dendrom√©tricos"
subtitle: "(Khaya Ivorensis - Mogno Africano)"
author:
- name: Deivison Venicio Souza
  email: |
   | üå≥üå≥üå≥üå≥üå≥üå≥
   | deivisonvs@ufpa.br
   | https://github.com/DeivisonSouza
  affiliation: Universidade Federal do Par√° - UFPA
fontsize: 14pt
lang: pt-BR
date: |
  | 1¬™ vers√£o: 10/Abril/2022
  | (Atualizado em: `r format(Sys.Date(),"%d/%B/%Y")`)

output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
    toc: yes
    df_print: paged
    number_sections: yes
---

```{r setup, include=T, echo=F}
library(rmarkdown)
knitr::opts_chunk$set(fig.align="center", cache=TRUE, prompt=FALSE, comment = NA, eval = TRUE)
```


# Informa√ß√µes gerais para simula√ß√£o

## Objetivos

- Simular dados para as vari√°veis di√¢metro a 1,30m do solo ($d$) e altura ($h$) para a esp√©cie üå≥*Khaya Ivorensis*üå≥.
- Calcular o volume das √°rvores usando a f√≥rmula $v_i = \dfrac{(\pi d^2)}{40000}(h)(0,7)$.

## Caracter√≠sticas admitidas para simula√ß√£o

Com objetivo de simular dados condizentes aos encontrados na natureza ser√° admitido que:

- A popula√ß√£o florestal de *Khaya Ivorensis* possui 15 anos de idade, e foi implantada usando o espa√ßamento 5m x 5m e pleno sol. Sob este espa√ßamento s√£o poss√≠veis estabelecer at√© 400 √°rvores por hectare.
- A popula√ß√£o florestal √© um ret√¢ngulo de 500m x 200m, ou seja, com √°rea total de 10 hectares. (Obviamente, na natureza ter-se-√° pol√≠gonos irregulares!)
- A popula√ß√£o florestal ser√° subdividida em √°reas de 100m x 100m (1 hectare). Portanto, o n√∫mero de parcelas poss√≠veis na popula√ß√£o ser√° igual a 10 (N = 10). (**Ser√° √∫til na AAS!**)
- N√£o ocorreu mortalidade no plantio at√© os 15 anos de idade (Um sonho!üòÄ). Portanto, a popula√ß√£o de *Khaya Ivorensis* ser√° composta de 4000 √°rvores.
- O intervalo de varia√ß√£o dos di√¢metros a 1,30m do solo na popula√ß√£o √© de 25cm (m√≠nimo) a 27cm (m√°ximo).
- O intervalo de varia√ß√£o das alturas comerciais na popula√ß√£o √© de 9m (m√≠nimo) a 10m (m√°ximo).

```{r, echo=FALSE, out.width='60%', fig.align='center', fig.cap='', dpi=600}
knitr::include_graphics('fig/class3/pop2.png')
```

# Simula√ß√£o de dados dendrom√©tricos

- Ser√£o simulados dados de $d$ (em, cm) e $h$ (em, m) para as 10 parcelas poss√≠veis de 1ha (400 √°rvores/parcela).
- Os dados ser√£o simulados a partir da distribui√ß√£o normal, variando a m√©dia e desvio padr√£o por parcela. 
- A fun√ß√£o `runif()` foi usada para gerar dados aleat√≥rios da distribui√ß√£o uniforme para os valores de m√©dia e desvio padr√£o usados na `rnorm()`. Por exemplo, para os di√¢metros das √°rvores, em cada parcela, admitiu-se para a m√©dia um valor m√≠nimo e m√°ximo de 25cm e 27cm, respectivamente.
- A fun√ß√£o `rnorm()` foi  usada para gerar dados aleat√≥rios com distribui√ß√£o normal. Esta possui 3 par√¢metros: **n** = n√∫mero de observa√ß√µes; **mean** = vetor de m√©dias; e **sd** = vetor de desvio padr√£o.


```{r library, eval=TRUE,message = FALSE}
## Carrega pacotes

library(purrr)
library(tidyr)
library(dplyr)
```


```{r}
## Gera valores aleat√≥rios de m√©dias e desvio padr√£o para uso na rnorm()
## Para cada parcela ser√° usada uma m√©dia e um desvio padr√£o diferente

set.seed(10)
df <- data.frame(
  mean_d = runif(n = 10, min = 25, max = 27),
  sd_d = runif(n = 10, min = 1, max = 2),
  mean_h = runif(n = 10, min = 9, max = 10),
  sd_h = runif(n = 10, min = .5, max = 1)
) %>% 
  mutate(across(everything(), round, 2))

  knitr::kable(df)
```


```{r}
## Simula dados normais para di√¢metro p/ cada parcela

arv_parc <- 1:400  # n√∫mero de observa√ß√µes/parcela (√°rvores/parcela)
n <- 10            # n√∫mero de parcelas

set.seed(100)
simul_d <- map_dfr(arv_parc, ~ setNames(rnorm(n, mean = df$mean_d, sd = df$sd_d),
                                        stringr::str_c("P", 1:10))) %>%
  pivot_longer(everything(), names_to = "Parc", values_to = "d") %>%
  mutate(across(where(is_character), forcats::as_factor)) %>%
  mutate(across(where(is_double), round, 2)) %>%
  arrange(Parc, desc(d))
```


```{r}
## Simula dados normais para altura p/ cada parcela

set.seed(100)
simul_h <- map_dfr(arv_parc, ~ setNames(rnorm(n, mean = df$mean_h, sd = df$sd_h),
                                        stringr::str_c("P", 1:10))) %>%
  pivot_longer(everything(), names_to = "Parc", values_to = "h") %>%
  mutate(across(where(is_character), forcats::as_factor)) %>%
  mutate(across(where(is_double), round, 1)) %>%
  arrange(Parc, desc(h))
```


```{r, message=F}
## Combina data.frames e calcula volume

data <- bind_cols(simul_d, simul_h[c("h")]) %>%
  mutate(v = ((pi*(d^2))/40000)*h*0.7) %>% 
  mutate(across(c(v), round, 4))

# writexl::write_xlsx(data, 'data/Khaya-simulado.xlsx')
```


```{r, message=F}
## Visualiza as 2 primeiras linhas de cada parcela

data %>%
  group_by(Parc) %>%
  top_n(n = 2) %>% 
  knitr::kable()
```


```{r, message=F}
## Calcula m√©dia, desvio e total do volume por Parcela

data %>%
  group_by(Parc) %>%
  summarise(across(#.cols = where(is.numeric),
                   .cols = v,
                   .fns = list(media=mean, desv=sd, soma=sum),
                   na.rm = TRUE,
                   .names = "{.col}.{.fn}"
  )
  ) %>% 
  knitr::kable()
```

**Considera√ß√£o Final**

- Simulamos dados para uma popula√ß√£o de *Khaya Ivorensis* (10 ha) com 4000 √°rvores e, admitindo que 10 parcelas de 1ha s√£o poss√≠veis de serem instaladas na popula√ß√£o. **Portanto, via simula√ß√£o temos os dados populacionais!**.
- Por√©m, na pr√°tica, em **invent√°rios florestais**, comumente os dados dendrom√©tricos s√£o medidos em **parcelas amostrais sob algum processo de amostragem** e, em seguida, a vari√°vel de interesse √© extrapolada para a popula√ß√£o (infer√™ncia).
- Portanto, na sequ√™ncia, vamos admitir esses dados para simular o uso da amostragem aleat√≥ria simples. Ou seja, vamos admitir que apenas **dados de algumas parcelas amostrais estar√£o dispon√≠veis!**

