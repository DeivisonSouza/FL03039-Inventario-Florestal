---
title: "Simulação de dados"
subtitle: "(Khaya Ivorensis - Mogno Africano)"
author: Prof. Dr. Deivison Venicio Souza
fontsize: 14pt
lang: pt-BR
date: '`r format(Sys.Date(),"%d/%B/%Y")`'

output:
  prettydoc::html_pretty:
    theme: architect
    highlight: vignette
    toc: yes
    df_print: paged
    number_sections: yes
  pdf_document:
    toc: yes
---

```{r setup, include=TRUE}
library(rmarkdown)
knitr::opts_chunk$set(fig.align="center", cache=TRUE, prompt=FALSE, comment = NA, eval = TRUE)
```


# Informações gerais para simulação

## Objetivos

- Simular dados para a váriável diâmetro a 1,30m do solo ($d$) e altura ($h$) para a espécie *Khaya Ivorensis*.
- Calcular o volume das árvores usando a fórmula $v_i = \dfrac{(\pi d^2)}{40000}(h)(0,7)$.

## Características do povoamento

- Admitir-se-á uma população florestal de *Khaya Ivorensis* com 15 anos de idade, implantada a pleno sol e sob o espaçamento 5m x 5m.
- Admitir-se-á uma área total de 10 hectares.
- Admitir-se-á o uso de parcelas de 100m x 100m, ou seja, 1ha. Portanto, o número de parcelas possíveis na população será igual a 10 (N = 10).
- Admitindo-se um espaçamento de 5m x 5m, em 1ha são possíveis 400 árvores (sem mortalidade!). Portanto, a população de *Khaya Ivorensis* será composta de 4000 árvores.

```{r, echo=FALSE, out.width='60%', fig.align='center', fig.cap='', dpi=600}
knitr::include_graphics('fig/class3/pop2.png')
```

# Simulação de dados dendrométricos

- Serão simulados dados de $d$ (em, cm) e $h$ (em, m) para as 10 parcelas possíveis de 1ha (400 árvores/parcela).
- Os dados serão simulados a partir da distribuição normal, variando a média e desvio padrão por parcela.
- A função `rnorm()` pode ser usada para gerar dados aleatórios com distribuição normal. Esta possui 3 parâmetros: **n** = número de observações; **mean** = vetor de médias; e **sd** = vetor de desvio padrão.

```{r library, eval=TRUE,message = FALSE}
## Carrega pacotes
library(purrr)
library(tidyr)
library(dplyr)
```


```{r}
## Gera valores aleatórios de médias e desvio padrão para uso na rnorm()
## Para cada parcela será usada uma média e um desvio padrão diferente

set.seed(10)
df <- data.frame(
  mean_d = runif(n = 10, min = 25, max = 27),
  sd_d = runif(n = 10, min = 1, max = 2),
  mean_h = runif(n = 10, min = 9, max = 10),
  sd_h = runif(n = 10, min = .5, max = 1)
) %>% 
  mutate(across(everything(), round, 2))

  knitr::kable(df)
```


```{r}
## Simula dados normais para diâmetro p/ cada parcela

arv_parc <- 1:400  # número de observações/parcela (árvores/parcela)
n <- 10            # número de parcelas

set.seed(100)
simul_d <- map_dfr(arv_parc, ~ setNames(rnorm(n, mean = df$mean_d, sd = df$sd_d),
                                        stringr::str_c("P", 1:10))) %>%
  pivot_longer(everything(), names_to = "Parc", values_to = "d") %>%
  mutate(across(where(is_character), forcats::as_factor)) %>%
  mutate(across(where(is_double), round, 2)) %>%
  arrange(Parc, desc(d))
```


```{r}
## Simula dados normais para altura p/ cada parcela

set.seed(100)
simul_h <- map_dfr(arv_parc, ~ setNames(rnorm(n, mean = df$mean_h, sd = df$sd_h),
                                        stringr::str_c("P", 1:10))) %>%
  pivot_longer(everything(), names_to = "Parc", values_to = "h") %>%
  mutate(across(where(is_character), forcats::as_factor)) %>%
  mutate(across(where(is_double), round, 1)) %>%
  arrange(Parc, desc(h))
```


```{r, message=F}
## Combina data.frames e calcula volume

data <- bind_cols(simul_d, simul_h[c("h")]) %>%
  mutate(v = ((pi*(d^2))/40000)*h*0.7) %>% 
  mutate(across(c(v), round, 4))
```


```{r, message=F}
## Visualiza as 2 primeiras linhas de cada parcela

data %>%
  group_by(Parc) %>%
  top_n(n = 2) %>% 
  knitr::kable()
```


```{r, message=F}
## Calcula média, desvio e total por Parcela

data %>%
  group_by(Parc) %>%
  summarise(across(#.cols = where(is.numeric),
                   .cols = v,
                   .fns = list(media=mean, desv=sd, soma=sum),
                   na.rm = TRUE,
                   .names = "{.col}.{.fn}"
  )
  ) %>% 
  knitr::kable()
```

**Considerações finais**

- Veja que simulamos dados dendrométricos para uma população de *Khaya Ivorensis* (10 ha) com 4000 árvores. **Portanto, via simulação temos os dados populacionais!**
- Porém, na prática, na maioria das vezes não teremos acesso aos dados populacionais. 
- Em Inventários Florestais, comumente são sorteadas algumas parcelas para medição em campo.

# Selecão de uma amostra

- Agora vamos supor o sorteio de 2 parcelas

```{r}
## Simula

```
