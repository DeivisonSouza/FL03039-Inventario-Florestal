---
title: "SimulaÃ§Ã£o de Dados DendromÃ©tricos"
subtitle: "(Khaya Ivorensis - Mogno Africano)"
author:
- name: Deivison Venicio Souza
  email: |
   | ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³ğŸŒ³
   | deivisonvs@ufpa.br
   | https://github.com/DeivisonSouza
  affiliation: Universidade Federal do ParÃ¡ - UFPA
fontsize: 14pt
lang: pt-BR
date: |
  | 1Âª versÃ£o: 10/Abril/2022
  | (Atualizado em: `r format(Sys.Date(),"%d/%B/%Y")`)

output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
    toc: yes
    df_print: paged
    number_sections: yes
---

```{r setup, include=T, echo=F}
library(rmarkdown)
knitr::opts_chunk$set(fig.align="center", cache=TRUE, prompt=FALSE, comment = NA, eval = TRUE)
```


# InformaÃ§Ãµes gerais para simulaÃ§Ã£o

## Objetivos

- Simular dados para as variÃ¡veis diÃ¢metro a 1,30m do solo ($d$) e altura ($h$) para a espÃ©cie ğŸŒ³*Khaya Ivorensis*ğŸŒ³.
- Calcular o volume das Ã¡rvores usando a fÃ³rmula $v_i = \dfrac{(\pi d^2)}{40000}(h)(0,7)$.

## CaracterÃ­sticas admitidas para simulaÃ§Ã£o

Com objetivo de simular dados condizentes aos encontrados na natureza serÃ¡ admitido que:

- A populaÃ§Ã£o florestal de ğŸŒ³*Khaya Ivorensis*ğŸŒ³ possui 15 anos de idade, e foi implantada usando o espaÃ§amento 5m x 5m e pleno sol. Sob este espaÃ§amento sÃ£o possÃ­veis estabelecer atÃ© 400 Ã¡rvores por hectare.
- A populaÃ§Ã£o florestal Ã© um retÃ¢ngulo de 500m x 200m, ou seja, com Ã¡rea total de 10 hectares. (Obviamente, na natureza ter-se-Ã¡ polÃ­gonos irregulares!)
- A populaÃ§Ã£o florestal serÃ¡ subdividida em Ã¡reas de 100m x 100m (1 hectare). Portanto, o nÃºmero de parcelas possÃ­veis na populaÃ§Ã£o serÃ¡ igual a 10 (N = 10). (**SerÃ¡ Ãºtil na AAS!**)
- NÃ£o ocorreu mortalidade no plantio atÃ© os 15 anos de idade (Um sonho!ğŸ˜€). Portanto, a populaÃ§Ã£o de ğŸŒ³*Khaya Ivorensis*ğŸŒ³ serÃ¡ composta de 4000 Ã¡rvores.
- O intervalo de variaÃ§Ã£o dos diÃ¢metros a 1,30m do solo na populaÃ§Ã£o Ã© de 25cm (mÃ­nimo) a 27cm (mÃ¡ximo).
- O intervalo de variaÃ§Ã£o das alturas comerciais na populaÃ§Ã£o Ã© de 9m (mÃ­nimo) a 10m (mÃ¡ximo).

```{r, echo=FALSE, out.width='60%', fig.align='center', fig.cap='', dpi=600}
knitr::include_graphics('fig/class3/pop2.png')
```

# SimulaÃ§Ã£o de dados dendromÃ©tricos

- SerÃ£o simulados dados de $d$ (cm) e $h$ (m) para as 10 parcelas possÃ­veis de 1 hectare (400 Ã¡rvores/parcela).
- Os dados serÃ£o simulados a partir da distribuiÃ§Ã£o normal, variando a mÃ©dia e desvio padrÃ£o por parcela. 
- A funÃ§Ã£o `runif()` serÃ¡ usada para gerar dados aleatÃ³rios da distribuiÃ§Ã£o uniforme para os valores de mÃ©dia e desvio padrÃ£o usados na `rnorm()`.
- A funÃ§Ã£o `rnorm()` foi  usada para gerar dados aleatÃ³rios da distribuiÃ§Ã£o normal. Esta possui 3 parÃ¢metros: **n** = nÃºmero de observaÃ§Ãµes; **mean** = vetor de mÃ©dias; e **sd** = vetor de desvio padrÃ£o.


```{r library, eval=TRUE,message = FALSE}
## Carrega pacotes

library(purrr)
library(tidyr)
library(dplyr)
```


```{r}
## Gera valores aleatÃ³rios de mÃ©dias e desvio padrÃ£o para uso na rnorm()
## Para cada parcela serÃ¡ usada uma mÃ©dia e um desvio padrÃ£o diferente

set.seed(10)
df <- data.frame(
  mean_d = runif(n = 10, min = 25, max = 27),
  sd_d = runif(n = 10, min = 1, max = 2),
  mean_h = runif(n = 10, min = 9, max = 10),
  sd_h = runif(n = 10, min = .5, max = 1)
) %>% 
  mutate(across(everything(), round, 2))

  knitr::kable(df)
```


```{r}
## Simula dados normais para diÃ¢metro p/ cada parcela

arv_parc <- 1:400  # nÃºmero de observaÃ§Ãµes/parcela (Ã¡rvores/parcela)
n <- 10            # nÃºmero de parcelas

set.seed(100)
simul_d <- map_dfr(arv_parc, ~ setNames(rnorm(n, mean = df$mean_d, sd = df$sd_d),
                                        stringr::str_c("P", 1:10))) %>%
  pivot_longer(everything(), names_to = "Parc", values_to = "d") %>%
  mutate(across(where(is_character), forcats::as_factor)) %>%
  mutate(across(where(is_double), round, 2)) %>%
  arrange(Parc, desc(d))
```


```{r}
## Simula dados normais para altura p/ cada parcela

set.seed(100)
simul_h <- map_dfr(arv_parc, ~ setNames(rnorm(n, mean = df$mean_h, sd = df$sd_h),
                                        stringr::str_c("P", 1:10))) %>%
  pivot_longer(everything(), names_to = "Parc", values_to = "h") %>%
  mutate(across(where(is_character), forcats::as_factor)) %>%
  mutate(across(where(is_double), round, 1)) %>%
  arrange(Parc, desc(h))
```


```{r, message=F}
## Combina data.frames e calcula volume

data <- bind_cols(simul_d, simul_h[c("h")]) %>%
  mutate(v = ((pi*(d^2))/40000)*h*0.7) %>% 
  mutate(across(c(v), round, 4))

# writexl::write_xlsx(data, 'data/Khaya-simulado.xlsx')
```


```{r, message=F}
## Visualiza as 2 primeiras linhas de cada parcela

data %>%
  group_by(Parc) %>%
  top_n(n = 2) %>% 
  knitr::kable()
```


```{r, message=F}
## Calcula mÃ©dia, desvio e total do volume por Parcela

data %>%
  group_by(Parc) %>%
  summarise(across(#.cols = where(is.numeric),
                   .cols = v,
                   .fns = list(media=mean, desv=sd, soma=sum),
                   na.rm = TRUE,
                   .names = "{.col}.{.fn}"
  )
  ) %>% 
  knitr::kable()
```

**ConsideraÃ§Ã£o Final**

- Simulamos dados para uma populaÃ§Ã£o florestal de ğŸŒ³*Khaya Ivorensis*ğŸŒ³ (10 hectares) com 4000 Ã¡rvores, admitindo que 10 parcelas de 1ha sÃ£o possÃ­veis de serem instaladas na populaÃ§Ã£o. **Portanto, via simulaÃ§Ã£o temos os dados populacionais!**.
- PorÃ©m, na prÃ¡tica, em **inventÃ¡rios florestais**, comumente os dados dendromÃ©tricos sÃ£o medidos em **parcelas amostrais sob algum processo de amostragem** e, em seguida, a variÃ¡vel de interesse Ã© extrapolada para a populaÃ§Ã£o (inferÃªncia).
- Portanto, na sequÃªncia, vamos admitir esses dados para simular o uso da amostragem aleatÃ³ria simples. Ou seja, vamos admitir que apenas **dados de algumas parcelas amostrais estarÃ£o disponÃ­veis!**

